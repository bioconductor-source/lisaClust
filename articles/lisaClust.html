<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to Clustering of Local Indicators of Spatial Assocation (LISA) curves • lisaClust</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to Clustering of Local Indicators of Spatial Assocation (LISA) curves">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">lisaClust</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.13.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/lisaClust.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/ellispatrick/lisaClust/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to Clustering of Local Indicators of Spatial Assocation (LISA) curves</h1>
                        <h4 data-toc-skip class="author">Nicolas
Canete</h4>
            <address class="author_afil">
      Westmead Institute for Medical Research, University of Sydney,
Australia<br><a class="author_email" href="mailto:#"></a><a href="mailto:nicolas.canete@sydney.edu.au" class="email">nicolas.canete@sydney.edu.au</a>
      </address>
                              <h4 data-toc-skip class="author">Ellis
Patrick</h4>
            <address class="author_afil">
      Westmead Institute for Medical Research, University of Sydney,
AustraliaSchool of Mathematics and Statistics, University of Sydney,
Australia<br><a class="author_email" href="mailto:#"></a><a href="mailto:ellis.patrick@sydney.edu.au" class="email">ellis.patrick@sydney.edu.au</a>
      </address>
                              <h4 data-toc-skip class="author">Alex Run
Qin</h4>
            <address class="author_afil">
      Westmead Institute for Medical Research, University of Sydney,
AustraliaSchool of Mathematics and Statistics, University of Sydney,
Australia<br><a class="author_email" href="mailto:#"></a><a href="mailto:alex.qin@sydney.edu.au" class="email">alex.qin@sydney.edu.au</a>
      </address>
                  
            <h4 data-toc-skip class="date">19 August 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ellispatrick/lisaClust/blob/devel/vignettes/lisaClust.Rmd"><code>vignettes/lisaClust.Rmd</code></a></small>
      <div class="d-none name"><code>lisaClust.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://bioconductor.github.io/BiocManager/" class="external-link">"BiocManager"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"lisaClust"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ellispatrick.github.io/lisaClust/" class="external-link">lisaClust</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ellispatrick.github.io/spicyR/" class="external-link">spicyR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/SydneyBioX/SpatialDatasets" class="external-link">SpatialDatasets</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Clustering local indicators of spatial association (LISA) functions
is a methodology for identifying consistent spatial organisation of
multiple cell-types in an unsupervised way. This can be used to enable
the characterization of interactions between multiple cell-types
simultaneously and can complement traditional pairwise analysis. In our
implementation our LISA curves are a localised summary of an L-function
from a Poisson point process model. Our framework <code>lisaClust</code>
can be used to provide a high-level summary of cell-type colocalization
in high-parameter spatial cytometry data, facilitating the
identification of distinct tissue compartments or identification of
complex cellular microenvironments.</p>
</div>
<div class="section level2">
<h2 id="quick-start">Quick start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="section level3">
<h3 id="generate-toy-data">Generate toy data<a class="anchor" aria-label="anchor" href="#generate-toy-data"></a>
</h3>
<p>TO illustrate our <code>lisaClust</code> framework, here we consider
a very simple toy example where two cell-types are completely separated
spatially. We simulate data for two different images.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">51773</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fl">3</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span></span>
<span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fl">3</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span> <span class="op">+</span> <span class="fl">3</span></span>
<span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="va">cellType</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"c"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">imageID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>, <span class="st">"s2"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">800</span>, <span class="fl">800</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">cellType</span>, <span class="va">imageID</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cells</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, colour <span class="op">=</span> <span class="va">cellType</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">imageID</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="lisaClust_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="create-single-cell-experiment-object">Create Single Cell Experiment object<a class="anchor" aria-label="anchor" href="#create-single-cell-experiment-object"></a>
</h3>
<p>First we store our data in a <code>SingleCellExperiment</code>
object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SCE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/SingleCellExperiment.html" class="external-link">SingleCellExperiment</a></span><span class="op">(</span>colData <span class="op">=</span> <span class="va">cells</span><span class="op">)</span></span>
<span><span class="va">SCE</span></span>
<span><span class="co">## class: SingleCellExperiment </span></span>
<span><span class="co">## dim: 0 1600 </span></span>
<span><span class="co">## metadata(0):</span></span>
<span><span class="co">## assays(0):</span></span>
<span><span class="co">## rownames: NULL</span></span>
<span><span class="co">## rowData names(0):</span></span>
<span><span class="co">## colnames: NULL</span></span>
<span><span class="co">## colData names(4): x y cellType imageID</span></span>
<span><span class="co">## reducedDimNames(0):</span></span>
<span><span class="co">## mainExpName: NULL</span></span>
<span><span class="co">## altExpNames(0):</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-lisaclust">Running lisaCLust<a class="anchor" aria-label="anchor" href="#running-lisaclust"></a>
</h3>
<p>We can then use the convenience function <code>lisaClust</code> to
simultaneously calculate local indicators of spatial association (LISA)
functions using the <code>lisa</code> function and perform k-means
clustering. The number of clusters can be specified with the
<code>k =</code> parameter. In the example below, we’ve chosen
<code>k = 2</code>, resulting in a total of 2 clusters.</p>
<p>These clusters are stored in <code>colData</code> of the
<code>SingleCellExperiment</code> object, as a new column with the
column name <code>regions</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SCE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lisaClust.html">lisaClust</a></span><span class="op">(</span><span class="va">SCE</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">SCE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## DataFrame with 6 rows and 5 columns</span></span>
<span><span class="co">##           x         y cellType     imageID      region</span></span>
<span><span class="co">##   &lt;numeric&gt; &lt;numeric&gt; &lt;factor&gt; &lt;character&gt; &lt;character&gt;</span></span>
<span><span class="co">## 1     36.72     38.58       c1          s1    region_2</span></span>
<span><span class="co">## 2     61.38     41.29       c1          s1    region_2</span></span>
<span><span class="co">## 3     33.59     80.98       c1          s1    region_2</span></span>
<span><span class="co">## 4     50.17     64.91       c1          s1    region_2</span></span>
<span><span class="co">## 5     82.93     35.60       c1          s1    region_2</span></span>
<span><span class="co">## 6     83.13      2.69       c1          s1    region_2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-identified-regions">Plot identified regions<a class="anchor" aria-label="anchor" href="#plot-identified-regions"></a>
</h3>
<p><code>lisaClust</code> also provides the convenient
<code>hatchingPlot</code> function to visualise the different regions
that have been demarcated by the clustering. <code>hatchingPlot</code>
outputs a <code>ggplot</code> object where the regions are marked by
different hatching patterns. In a real biological dataset, this allows
us to plot both regions and cell-types on the same visualization.</p>
<p>In the example below, we can visualise our stimulated data where our
2 cell types have been separated neatly into 2 distinct regions based on
which cell type each region is dominated by. <code>region_2</code> is
dominated by the red cell type <code>c1</code>, and
<code>region_1</code> is dominated by the blue cell type
<code>c2</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hatchingPlot.html">hatchingPlot</a></span><span class="op">(</span><span class="va">SCE</span>, useImages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>, <span class="st">"s2"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="lisaClust_files/figure-html/unnamed-chunk-7-1.png" width="700">
## Using other clustering methods.</p>
<p>While the <code>lisaClust</code> function is convenient, we have not
implemented an exhaustive suite of clustering methods as it is very easy
to do this yourself. There are just two simple steps.</p>
<div class="section level4">
<h4 id="generate-lisa-curves">Generate LISA curves<a class="anchor" aria-label="anchor" href="#generate-lisa-curves"></a>
</h4>
<p>We can calculate local indicators of spatial association (LISA)
functions using the <code>lisa</code> function. Here the LISA curves are
a localised summary of an L-function from a Poisson point process model.
The radii that will be calculated over can be set with
<code>Rs</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lisaCurves</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lisa.html">lisa</a></span><span class="op">(</span><span class="va">SCE</span>, Rs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="perform-some-clustering">Perform some clustering<a class="anchor" aria-label="anchor" href="#perform-some-clustering"></a>
</h4>
<p>The LISA curves can then be used to cluster the cells. Here we use
k-means clustering, other clustering methods like SOM could be used. We
can store these cell clusters or cell “regions” in our
<code>SingleCellExperiment</code> object.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Custom clustering algorithm</span></span>
<span><span class="va">kM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a></span><span class="op">(</span><span class="va">lisaCurves</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Storing clusters into colData</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">SCE</span><span class="op">)</span><span class="op">$</span><span class="va">custom_region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"region"</span>, <span class="va">kM</span><span class="op">$</span><span class="va">cluster</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">SCE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## DataFrame with 6 rows and 6 columns</span></span>
<span><span class="co">##           x         y cellType     imageID      region custom_region</span></span>
<span><span class="co">##   &lt;numeric&gt; &lt;numeric&gt; &lt;factor&gt; &lt;character&gt; &lt;character&gt;   &lt;character&gt;</span></span>
<span><span class="co">## 1     36.72     38.58       c1          s1    region_2      region_2</span></span>
<span><span class="co">## 2     61.38     41.29       c1          s1    region_2      region_2</span></span>
<span><span class="co">## 3     33.59     80.98       c1          s1    region_2      region_2</span></span>
<span><span class="co">## 4     50.17     64.91       c1          s1    region_2      region_2</span></span>
<span><span class="co">## 5     82.93     35.60       c1          s1    region_2      region_2</span></span>
<span><span class="co">## 6     83.13      2.69       c1          s1    region_2      region_2</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="keren-et-al--breast-cancer-data-">Keren et al. breast cancer data.<a class="anchor" aria-label="anchor" href="#keren-et-al--breast-cancer-data-"></a>
</h2>
<p>Next, we apply our <code>lisaClust</code> framework to two images of
breast cancer from <em>A Structured Tumor-Immune Microenvironment in
Triple Negative Breast Cancer Revealed by Multiplexed Ion Beam
Imaging</em> by Keren et al. (2018)</p>
<div class="section level3">
<h3 id="read-in-data">Read in data<a class="anchor" aria-label="anchor" href="#read-in-data"></a>
</h3>
<p>We will start by reading in the data from the
<code>SpatialDatasets</code> package as a
<code>SingleCellExperiment</code> object. Here the data is in a format
consistent with that outputted by CellProfiler.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kerenSPE</span> <span class="op">&lt;-</span> <span class="fu">SpatialDatasets</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SpatialDatasets/man/SpatialDatasets.html" class="external-link">spe_Keren_2018</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generate-lisa-curves-1">Generate LISA curves<a class="anchor" aria-label="anchor" href="#generate-lisa-curves-1"></a>
</h3>
<p>This data includes annotation of the cell-types of each cell. Hence,
we can move directly to performing k-means clustering on the local
indicators of spatial association (LISA) functions using the
<code>lisaClust</code> function, remembering to specify the
<code>imageID</code>, <code>cellType</code>, and
<code>spatialCoords</code> columns in <code>colData</code>. For the
purpose of demonstration, we will be using only images 5 &amp; 6 of the
<code>kerenSPE</code> dataset.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kerenSPE</span> <span class="op">&lt;-</span> <span class="va">kerenSPE</span><span class="op">[</span>,<span class="va">kerenSPE</span><span class="op">$</span><span class="va">imageID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"5"</span>, <span class="st">"6"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">kerenSPE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lisaClust.html">lisaClust</a></span><span class="op">(</span><span class="va">kerenSPE</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>These regions are stored in <code>colData</code> and can be
extracted.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">kerenSPE</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"imageID"</span>, <span class="st">"region"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">## DataFrame with 20 rows and 2 columns</span></span>
<span><span class="co">##           imageID      region</span></span>
<span><span class="co">##       &lt;character&gt; &lt;character&gt;</span></span>
<span><span class="co">## 21154           5    region_4</span></span>
<span><span class="co">## 21155           5    region_4</span></span>
<span><span class="co">## 21156           5    region_4</span></span>
<span><span class="co">## 21157           5    region_3</span></span>
<span><span class="co">## 21158           5    region_3</span></span>
<span><span class="co">## ...           ...         ...</span></span>
<span><span class="co">## 21169           5    region_3</span></span>
<span><span class="co">## 21170           5    region_3</span></span>
<span><span class="co">## 21171           5    region_1</span></span>
<span><span class="co">## 21172           5    region_3</span></span>
<span><span class="co">## 21173           5    region_1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="examine-cell-type-enrichment">Examine cell type enrichment<a class="anchor" aria-label="anchor" href="#examine-cell-type-enrichment"></a>
</h3>
<p><code>lisaClust</code> also provides a convenient function,
<code>regionMap</code>, for examining which cell types are located in
which regions. In this example, we use this to check which cell types
appear more frequently in each region than expected by chance.</p>
<p>Here, we clearly see that healthy epithelial and mesenchymal tissue
are highly concentrated in region 1, immune cells are concentrated in
regions 2 and 4, whilst tumour cells are spread out across regions 3 and
5.</p>
<p>We can further segregate these cells by increasing the number of
clusters, ie. increasing the parameter <code>k =</code> in the
<code><a href="../reference/lisaClust.html">lisaClust()</a></code> function, but for the purposes of
demonstration, let’s take a look at the <code>hatchingPlot</code> of
these regions.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/regionMap.html">regionMap</a></span><span class="op">(</span><span class="va">kerenSPE</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"bubble"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="lisaClust_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="plot-identified-regions-1">Plot identified regions<a class="anchor" aria-label="anchor" href="#plot-identified-regions-1"></a>
</h3>
<p>Finally, we can use <code>hatchingPlot</code> to construct a
<code>ggplot</code> object where the regions are marked by different
hatching patterns. This allows us to visualize the 5 regions and 17
cell-types simultaneously.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hatchingPlot.html">hatchingPlot</a></span><span class="op">(</span><span class="va">kerenSPE</span><span class="op">)</span></span></code></pre></div>
<p><img src="lisaClust_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="sessioninfo">sessionInfo()<a class="anchor" aria-label="anchor" href="#sessioninfo"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] SpatialDatasets_1.2.0       SpatialExperiment_1.14.0   </span></span>
<span><span class="co">##  [3] ExperimentHub_2.12.0        AnnotationHub_3.12.0       </span></span>
<span><span class="co">##  [5] BiocFileCache_2.12.0        dbplyr_2.5.0               </span></span>
<span><span class="co">##  [7] SingleCellExperiment_1.26.0 SummarizedExperiment_1.34.0</span></span>
<span><span class="co">##  [9] Biobase_2.64.0              GenomicRanges_1.56.1       </span></span>
<span><span class="co">## [11] GenomeInfoDb_1.40.1         IRanges_2.38.1             </span></span>
<span><span class="co">## [13] S4Vectors_0.42.1            BiocGenerics_0.50.0        </span></span>
<span><span class="co">## [15] MatrixGenerics_1.16.0       matrixStats_1.3.0          </span></span>
<span><span class="co">## [17] ggplot2_3.5.1               spicyR_1.16.3              </span></span>
<span><span class="co">## [19] lisaClust_1.13.3            BiocStyle_2.32.1           </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] RColorBrewer_1.1-3          jsonlite_1.8.8             </span></span>
<span><span class="co">##   [3] MultiAssayExperiment_1.30.3 magrittr_2.0.3             </span></span>
<span><span class="co">##   [5] spatstat.utils_3.1-0        magick_2.8.4               </span></span>
<span><span class="co">##   [7] farver_2.1.2                nloptr_2.1.1               </span></span>
<span><span class="co">##   [9] rmarkdown_2.28              fs_1.6.4                   </span></span>
<span><span class="co">##  [11] zlibbioc_1.50.0             ragg_1.3.2                 </span></span>
<span><span class="co">##  [13] vctrs_0.6.5                 memoise_2.0.1              </span></span>
<span><span class="co">##  [15] minqa_1.2.8                 spatstat.explore_3.3-1     </span></span>
<span><span class="co">##  [17] rstatix_0.7.2               htmltools_0.5.8.1          </span></span>
<span><span class="co">##  [19] S4Arrays_1.4.1              curl_5.2.1                 </span></span>
<span><span class="co">##  [21] broom_1.0.6                 SparseArray_1.4.8          </span></span>
<span><span class="co">##  [23] sass_0.4.9                  bslib_0.8.0                </span></span>
<span><span class="co">##  [25] desc_1.4.3                  plyr_1.8.9                 </span></span>
<span><span class="co">##  [27] cachem_1.1.0                mime_0.12                  </span></span>
<span><span class="co">##  [29] lifecycle_1.0.4             pkgconfig_2.0.3            </span></span>
<span><span class="co">##  [31] Matrix_1.7-0                R6_2.5.1                   </span></span>
<span><span class="co">##  [33] fastmap_1.2.0               GenomeInfoDbData_1.2.12    </span></span>
<span><span class="co">##  [35] digest_0.6.36               numDeriv_2016.8-1.1        </span></span>
<span><span class="co">##  [37] colorspace_2.1-1            AnnotationDbi_1.66.0       </span></span>
<span><span class="co">##  [39] tensor_1.5                  RSQLite_2.3.7              </span></span>
<span><span class="co">##  [41] textshaping_0.4.0           ggpubr_0.6.0               </span></span>
<span><span class="co">##  [43] labeling_0.4.3              filelock_1.0.3             </span></span>
<span><span class="co">##  [45] fansi_1.0.6                 spatstat.sparse_3.1-0      </span></span>
<span><span class="co">##  [47] httr_1.4.7                  polyclip_1.10-7            </span></span>
<span><span class="co">##  [49] abind_1.4-5                 mgcv_1.9-1                 </span></span>
<span><span class="co">##  [51] compiler_4.4.1              bit64_4.0.5                </span></span>
<span><span class="co">##  [53] withr_3.0.1                 backports_1.5.0            </span></span>
<span><span class="co">##  [55] BiocParallel_1.38.0         carData_3.0-5              </span></span>
<span><span class="co">##  [57] DBI_1.2.3                   highr_0.11                 </span></span>
<span><span class="co">##  [59] ggupset_0.4.0               ggforce_0.4.2              </span></span>
<span><span class="co">##  [61] ggsignif_0.6.4              MASS_7.3-60.2              </span></span>
<span><span class="co">##  [63] concaveman_1.1.0            rappdirs_0.3.3             </span></span>
<span><span class="co">##  [65] DelayedArray_0.30.1         rjson_0.2.21               </span></span>
<span><span class="co">##  [67] tools_4.4.1                 goftest_1.2-3              </span></span>
<span><span class="co">##  [69] glue_1.7.0                  nlme_3.1-164               </span></span>
<span><span class="co">##  [71] grid_4.4.1                  ClassifyR_3.8.3            </span></span>
<span><span class="co">##  [73] reshape2_1.4.4              generics_0.1.3             </span></span>
<span><span class="co">##  [75] gtable_0.3.5                spatstat.data_3.1-2        </span></span>
<span><span class="co">##  [77] class_7.3-22                tidyr_1.3.1                </span></span>
<span><span class="co">##  [79] data.table_1.15.4           car_3.1-2                  </span></span>
<span><span class="co">##  [81] utf8_1.2.4                  XVector_0.44.0             </span></span>
<span><span class="co">##  [83] spatstat.geom_3.3-2         BiocVersion_3.19.1         </span></span>
<span><span class="co">##  [85] pillar_1.9.0                stringr_1.5.1              </span></span>
<span><span class="co">##  [87] splines_4.4.1               dplyr_1.1.4                </span></span>
<span><span class="co">##  [89] tweenr_2.0.3                lattice_0.22-6             </span></span>
<span><span class="co">##  [91] bit_4.0.5                   survival_3.6-4             </span></span>
<span><span class="co">##  [93] deldir_2.0-4                tidyselect_1.2.1           </span></span>
<span><span class="co">##  [95] Biostrings_2.72.1           knitr_1.48                 </span></span>
<span><span class="co">##  [97] V8_5.0.0                    bookdown_0.40              </span></span>
<span><span class="co">##  [99] xfun_0.47                   pheatmap_1.0.12            </span></span>
<span><span class="co">## [101] scam_1.2-17                 stringi_1.8.4              </span></span>
<span><span class="co">## [103] UCSC.utils_1.0.0            yaml_2.3.10                </span></span>
<span><span class="co">## [105] boot_1.3-30                 evaluate_0.24.0            </span></span>
<span><span class="co">## [107] codetools_0.2-20            tibble_3.2.1               </span></span>
<span><span class="co">## [109] BiocManager_1.30.23         cli_3.6.3                  </span></span>
<span><span class="co">## [111] systemfonts_1.1.0           munsell_0.5.1              </span></span>
<span><span class="co">## [113] jquerylib_0.1.4             Rcpp_1.0.13                </span></span>
<span><span class="co">## [115] spatstat.random_3.3-1       png_0.1-8                  </span></span>
<span><span class="co">## [117] spatstat.univar_3.0-0       parallel_4.4.1             </span></span>
<span><span class="co">## [119] blob_1.2.4                  pkgdown_2.1.0              </span></span>
<span><span class="co">## [121] lme4_1.1-35.5               lmerTest_3.1-3             </span></span>
<span><span class="co">## [123] scales_1.3.0                purrr_1.0.2                </span></span>
<span><span class="co">## [125] crayon_1.5.3                rlang_1.1.4                </span></span>
<span><span class="co">## [127] KEGGREST_1.44.1</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ellis Patrick, Nicolas Canete.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
